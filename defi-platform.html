<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HCF DeFi Platform - å®Œæ•´åŠŸèƒ½ç‰ˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .nav-tabs {
            display: flex;
            gap: 20px;
            background: white;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .nav-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 16px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .page-content {
            display: none;
        }
        .page-content.active {
            display: block;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }
        .card-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 8px;
        }
        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .card-suffix {
            font-size: 14px;
            color: #667eea;
            margin-left: 5px;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
        }
        .btn-success {
            background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
        }
        .input-group {
            margin: 20px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 0 5px;
        }
        .badge-success {
            background: #e8f5e9;
            color: #4caf50;
        }
        .badge-warning {
            background: #fff3e0;
            color: #ff9800;
        }
        .badge-danger {
            background: #ffebee;
            color: #f44336;
        }
        .badge-info {
            background: #e3f2fd;
            color: #2196f3;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #667eea;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .info-box {
            background: #f0f8ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .error-box {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .level-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .level-card:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .level-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .level-card h3 {
            margin: 0 0 10px 0;
        }
        .level-card p {
            margin: 5px 0;
            font-size: 14px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .stat-label {
            color: #666;
        }
        .stat-value {
            font-weight: bold;
            color: #333;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ğŸš€ HCF DeFi Platform</div>
            <div id="wallet-status">
                <button class="btn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('dashboard')">ğŸ“Š ä»ªè¡¨ç›˜</button>
            <button class="nav-tab" onclick="switchPage('staking')">ğŸ’° è´¨æŠ¼æ± </button>
            <button class="nav-tab" onclick="switchPage('referral')">ğŸ‘¥ æ¨è</button>
            <button class="nav-tab" onclick="switchPage('nodenft')">ğŸ¨ èŠ‚ç‚¹NFT</button>
            <button class="nav-tab" onclick="switchPage('exchange')">ğŸ’± å…‘æ¢</button>
            <button class="nav-tab" onclick="switchPage('ranking')">ğŸ† æ’å</button>
            <button class="nav-tab" onclick="switchPage('governance')">ğŸ—³ï¸ æ²»ç†</button>
        </div>

        <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
        <div id="dashboard-page" class="page-content active">
            <h2 style="color: white; margin-bottom: 20px;">ä»ªè¡¨ç›˜ - æ€»è§ˆ</h2>
            
            <!-- èµ„äº§æ¦‚è§ˆ -->
            <div class="grid">
                <div class="card">
                    <div class="card-title">HCF ä½™é¢</div>
                    <div class="card-value">
                        <span id="hcf-balance">0.00</span>
                        <span class="card-suffix">HCF</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">BSDT ä½™é¢</div>
                    <div class="card-value">
                        <span id="bsdt-balance">0.00</span>
                        <span class="card-suffix">BSDT</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">BNB ä½™é¢</div>
                    <div class="card-value">
                        <span id="bnb-balance">0.00</span>
                        <span class="card-suffix">BNB</span>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">æ—¥æ”¶ç›Š</div>
                    <div class="card-value" style="color: #4caf50;">
                        <span id="daily-income">0.00</span>
                        <span class="card-suffix">HCF</span>
                    </div>
                </div>
            </div>

            <!-- å›¢é˜Ÿå’Œå¹³å°ä¿¡æ¯ -->
            <div class="grid">
                <div class="card">
                    <div class="card-title">å›¢é˜Ÿç­‰çº§</div>
                    <div class="card-value">
                        <span id="team-level">V0</span>
                        <span class="badge badge-info" id="team-badge">æœªæ¿€æ´»</span>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>å›¢é˜Ÿä¸šç»©: <span id="team-volume">0</span> HCF</small>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">æ€»ä¾›åº”é‡</div>
                    <div class="card-value">
                        <span id="total-supply">1,000,000,000</span>
                        <span class="card-suffix">HCF</span>
                    </div>
                    <div style="margin-top: 10px;">
                        <small>ä»·æ ¼åŒºé—´: $0.99 - $1.01</small>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">èŠ‚ç‚¹æ•°é‡</div>
                    <div class="card-value">
                        <span id="node-count">45</span> / 99
                    </div>
                    <div class="progress">
                        <div class="progress-bar" style="width: 45%;"></div>
                    </div>
                </div>
            </div>

            <!-- åŠ¨æ€æ”¶ç›Šå’Œè¡°å‡ -->
            <div class="grid">
                <div class="card">
                    <h3>åŠ¨æ€æ”¶ç›Šæ¯”</h3>
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 48px; font-weight: bold; color: #667eea;">
                            <span id="dynamic-yield">70</span>%
                        </div>
                        <div style="margin-top: 10px;">
                            <div>åŸºç¡€: 1000 HCF</div>
                            <div>å½“å‰: 70%</div>
                            <div style="color: #4caf50; font-weight: bold;">å®é™…: 700 HCF</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>è¡°å‡çŠ¶æ€</h3>
                    <div class="stat-item">
                        <span class="stat-label">æ€»è´¨æŠ¼é‡</span>
                        <span class="stat-value">1.1äº¿ HCF</span>
                    </div>
                    <div class="warning-box">
                        è¡°å‡ç‡: 0.1% (æ€»è´¨æŠ¼è¶…è¿‡1.1äº¿)
                    </div>
                </div>
                <div class="card">
                    <h3>åŠ æˆåˆ—è¡¨</h3>
                    <div class="stat-item">
                        <span class="stat-label">æŒæœ‰æ—¶é•¿</span>
                        <span class="stat-value">+10%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å›¢é˜Ÿç­‰çº§</span>
                        <span class="stat-value">+5%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">èŠ‚ç‚¹æŒæœ‰</span>
                        <span class="stat-value">+20%</span>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; margin-top: 10px; padding-top: 10px;">
                        <strong>æ€»åŠ æˆ: +35%</strong>
                    </div>
                </div>
            </div>

            <!-- é”€æ¯å’Œæ— å¸¸æŸå¤± -->
            <div class="grid">
                <div class="card">
                    <h3>é”€æ¯ç‡æç¤º</h3>
                    <div class="error-box">
                        å½“å‰é”€æ¯ç‡: 5%<br>
                        æ¯ç¬”äº¤æ˜“å°†é”€æ¯5%çš„ä»£å¸
                    </div>
                </div>
                <div class="card">
                    <h3>æ— å¸¸æŸå¤±çŠ¶æ€</h3>
                    <div class="warning-box">
                        å½“å‰æŸå¤±: -500 HCF<br>
                        è¡¥å¿æ± : 10,000 HCF
                    </div>
                    <button class="btn btn-success">ç”³è¯·è¡¥å¿</button>
                </div>
                <div class="card">
                    <h3>æ’åå¥–åŠ±æ¦‚è§ˆ</h3>
                    <div class="info-box">
                        è´¨æŠ¼æ’å: #50<br>
                        é¢å¤–åŠ æˆ: +20%<br>
                        é¢å¤–å¥–åŠ±: 2000 HCF
                    </div>
                </div>
            </div>

            <!-- æœ€æ–°äº¤æ˜“ -->
            <div class="card">
                <h3>æœ€æ–°äº¤æ˜“</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>ç±»å‹</th>
                            <th>æ•°é‡</th>
                            <th>æ—¶é—´</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="recent-transactions">
                        <tr>
                            <td><span class="badge badge-success">æ¥æ”¶</span></td>
                            <td>1000 HCF</td>
                            <td>2åˆ†é’Ÿå‰</td>
                            <td><span class="badge badge-success">æˆåŠŸ</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- åŠŸèƒ½å…¥å£æŒ‰é’® -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 20px;">
                <button class="btn" onclick="switchPage('staking')">è¿›å…¥è´¨æŠ¼</button>
                <button class="btn" onclick="switchPage('referral')">è¿›å…¥æ¨è</button>
                <button class="btn" onclick="switchPage('nodenft')">è¿›å…¥èŠ‚ç‚¹</button>
                <button class="btn" onclick="switchPage('exchange')">è¿›å…¥å…‘æ¢</button>
                <button class="btn" onclick="switchPage('ranking')">è¿›å…¥æ’å</button>
                <button class="btn" onclick="switchPage('governance')">è¿›å…¥æ²»ç†</button>
            </div>
        </div>

        <!-- è´¨æŠ¼æ± é¡µé¢ -->
        <div id="staking-page" class="page-content">
            <h2 style="color: white; margin-bottom: 20px;">è´¨æŠ¼æ± </h2>
            
            <!-- è´¨æŠ¼ç­‰çº§é€‰æ‹© -->
            <div class="card">
                <h3>é€‰æ‹©è´¨æŠ¼ç­‰çº§</h3>
                <div class="level-grid">
                    <div class="level-card" onclick="selectStakingLevel(1, this)">
                        <h3>Level 1</h3>
                        <p>æœ€ä½: 10 HCF</p>
                        <p>æ—¥åŒ–: 0.4%</p>
                        <p>LP: 0.8%</p>
                        <p>å¤æŠ•: 10å€</p>
                    </div>
                    <div class="level-card" onclick="selectStakingLevel(2, this)">
                        <h3>Level 2</h3>
                        <p>æœ€ä½: 100 HCF</p>
                        <p>æ—¥åŒ–: 0.5%</p>
                        <p>LP: 1.0%</p>
                        <p>å¤æŠ•: 20å€</p>
                    </div>
                    <div class="level-card" onclick="selectStakingLevel(3, this)">
                        <h3>Level 3</h3>
                        <p>æœ€ä½: 1,000 HCF</p>
                        <p>æ—¥åŒ–: 0.6%</p>
                        <p>LP: 1.2%</p>
                        <p>å¤æŠ•: 200å€</p>
                    </div>
                    <div class="level-card" onclick="selectStakingLevel(4, this)">
                        <h3>Level 4</h3>
                        <p>æœ€ä½: 10,000 HCF</p>
                        <p>æ—¥åŒ–: 0.7%</p>
                        <p>LP: 1.4%</p>
                        <p>å¤æŠ•: 2,000å€</p>
                    </div>
                    <div class="level-card" onclick="selectStakingLevel(5, this)">
                        <h3>Level 5</h3>
                        <p>æœ€ä½: 100,000 HCF</p>
                        <p>æ—¥åŒ–: 0.8%</p>
                        <p>LP: 1.6%</p>
                        <p>å¤æŠ•: 20,000å€</p>
                    </div>
                </div>
            </div>

            <!-- è´¨æŠ¼è¾“å…¥ -->
            <div class="card">
                <h3>è´¨æŠ¼è®¾ç½®</h3>
                <div class="input-group">
                    <label>HCF æ•°é‡</label>
                    <input type="number" id="stake-amount" placeholder="è¾“å…¥è´¨æŠ¼æ•°é‡">
                </div>
                <div class="input-group">
                    <label>BSDT æ•°é‡ (LP)</label>
                    <input type="number" id="bsdt-amount" placeholder="è¾“å…¥BSDTæ•°é‡ (å¯é€‰)">
                </div>
                <div style="display: flex; gap: 20px; margin: 20px 0;">
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="is-lp" style="margin-right: 10px;">
                        LPè´¨æŠ¼ (åŒå€æ”¶ç›Š)
                    </label>
                    <label style="display: flex; align-items: center;">
                        <input type="checkbox" id="is-equity" style="margin-right: 10px;">
                        è‚¡æƒè´¨æŠ¼ (+50%)
                    </label>
                </div>
                <div class="input-group">
                    <label>å¤æŠ•å€æ•°</label>
                    <select id="compound-multiple">
                        <option value="1">ä¸å¤æŠ•</option>
                        <option value="10">10å€</option>
                        <option value="100">100å€</option>
                        <option value="1000">1000å€</option>
                    </select>
                </div>
            </div>

            <!-- æ˜¾ç¤ºæ‹†åˆ†å’Œæ”¶ç›Šè®¡ç®— -->
            <div class="card">
                <h3>è´¨æŠ¼æ‹†åˆ†æ˜¾ç¤º</h3>
                <div class="info-box">
                    <div id="stake-split">
                        ç­‰å¾…è¾“å…¥...
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">åŠ¨æ€æ”¶ç›Šæ¯”</span>
                        <span class="stat-value">70%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å®é™…æ”¶ç›Š</span>
                        <span class="stat-value" id="actual-yield">0 HCF</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è¡°å‡ç‡</span>
                        <span class="stat-value">0.1%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ€»åŠ æˆ</span>
                        <span class="stat-value">+35%</span>
                    </div>
                </div>
            </div>

            <!-- é™è´­å’Œæé†’ -->
            <div class="grid">
                <div class="card">
                    <h3>é™è´­æé†’</h3>
                    <div class="warning-box">
                        å‰7å¤©é™è´­å‰©ä½™: 300 HCF<br>
                        ä»Šæ—¥å·²è´¨æŠ¼: 700 HCF
                    </div>
                </div>
                <div class="card">
                    <h3>èµå›è§„åˆ™</h3>
                    <div class="info-box">
                        1:1èµå›æ£€æŸ¥<br>
                        æœªè¾¾æ ‡å‡†å°†é”€æ¯30%<br>
                        LPèµå›é¢å¤–æ‰£é™¤10% BNB
                    </div>
                </div>
                <div class="card">
                    <h3>æ— å¸¸æŸå¤±è¡¥å¿</h3>
                    <div class="error-box">
                        å½“å‰æŸå¤±: -500 HCF
                    </div>
                    <button class="btn btn-success">è¡¥å¿500 HCF (+20%ä¼˜å…ˆ)</button>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="card">
                <h3>æ“ä½œ</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button class="btn" onclick="stake()">è´¨æŠ¼</button>
                    <button class="btn btn-danger" onclick="unstake()">èµå›</button>
                    <button class="btn btn-success" onclick="claimRewards()">é¢†å–å¥–åŠ±</button>
                    <button class="btn" onclick="compound()">å¤æŠ•</button>
                    <button class="btn btn-secondary" onclick="payEquityLP()">è‚¡æƒLPæ”¯ä»˜</button>
                    <button class="btn btn-success" onclick="claimCompensation()">è¡¥æ— å¸¸æŸå¤±</button>
                </div>
            </div>

            <!-- æˆ‘çš„è´¨æŠ¼ä¿¡æ¯ -->
            <div class="card">
                <h3>æˆ‘çš„è´¨æŠ¼ä¿¡æ¯</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">è´¨æŠ¼æ•°é‡</span>
                        <span class="stat-value" id="my-staked">0 HCF</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è´¨æŠ¼ç­‰çº§</span>
                        <span class="stat-value" id="my-level">æ— </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¾…é¢†å–å¥–åŠ±</span>
                        <span class="stat-value" id="pending-rewards">0 HCF</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç´¯è®¡æ”¶ç›Š</span>
                        <span class="stat-value" id="total-rewards">0 HCF</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- å…¶ä»–é¡µé¢å ä½ -->
        <div id="referral-page" class="page-content">
            <div class="card">
                <h2>æ¨èç³»ç»Ÿ</h2>
                <p>æ¨èåŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="nodenft-page" class="page-content">
            <div class="card">
                <h2>èŠ‚ç‚¹NFT</h2>
                <p>èŠ‚ç‚¹NFTåŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="exchange-page" class="page-content">
            <div class="card">
                <h2>å…‘æ¢</h2>
                <p>å…‘æ¢åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="ranking-page" class="page-content">
            <div class="card">
                <h2>æ’å</h2>
                <p>æ’ååŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>

        <div id="governance-page" class="page-content">
            <div class="card">
                <h2>æ²»ç†</h2>
                <p>æ²»ç†åŠŸèƒ½å¼€å‘ä¸­...</p>
            </div>
        </div>
    </div>

    <!-- åŠ è½½Ethers.js -->
    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <script>
        // åˆçº¦åœ°å€
        const CONTRACTS = {
            HCF: '0x09F320b75e6A74994713a0e4Be54eF8f09fbaEcc',
            BSDT: '0x622e568976f6cC2eaE4cfd3836d92F111000E787',
            Staking: '0x6E4e682Cc90124Ef66a8cfC8Fc875CF5Ee8E8a74',
            NodeNFT: '0xFCd9c088f387C2C5a4ef87b87bde979a6EaAbA15',
            Referral: '0x4DBDcfC87D528F616e5B11b9bc84e7C00F0Fc674',
            Exchange: '0xb97E39eE96652baB8FEfBe49AA8cD9f2b1F829c7'
        };

        // ABIå®šä¹‰
        const HCF_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function totalSupply() view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)",
            "function transfer(address to, uint256 amount) returns (bool)"
        ];

        const STAKING_ABI = [
            "function stake(uint256 amount, bool isLP, bool isEquity) returns (bool)",
            "function unstake() returns (bool)",
            "function claimReward() returns (bool)",
            "function compound(uint256 multiple) returns (bool)",
            "function getUserInfo(address user) view returns (tuple(uint256 amount, uint256 rewardDebt, uint256 pendingReward, uint256 lastStakeTime, uint256 level, bool isActive, uint256 totalClaimed, uint256 referralReward, bool isLP))",
            "function totalStaked() view returns (uint256)"
        ];

        // å…¨å±€å˜é‡
        let provider = null;
        let signer = null;
        let account = null;
        let connected = false;
        let selectedLevel = 0;

        // é¡µé¢åˆ‡æ¢
        function switchPage(page) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page-content').forEach(p => {
                p.classList.remove('active');
            });
            // æ˜¾ç¤ºé€‰ä¸­é¡µé¢
            document.getElementById(`${page}-page`).classList.add('active');
            
            // æ›´æ–°å¯¼èˆªæ ‡ç­¾
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // è¿æ¥é’±åŒ…
        async function connectWallet() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('è¯·å®‰è£… MetaMask é’±åŒ…');
                    return;
                }

                provider = new ethers.providers.Web3Provider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                
                if (accounts.length === 0) {
                    throw new Error('æ²¡æœ‰æ‰¾åˆ°è´¦æˆ·');
                }
                
                account = accounts[0];
                signer = provider.getSigner();
                connected = true;
                
                // æ£€æŸ¥ç½‘ç»œ
                const network = await provider.getNetwork();
                if (network.chainId !== 97) {
                    await switchToBSCTestnet();
                }
                
                // æ›´æ–°UI
                document.getElementById('wallet-status').innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: #4caf50;">â—</span>
                        <span>${account.substring(0, 6)}...${account.substring(38)}</span>
                        <button class="btn btn-secondary" onclick="disconnect()">æ–­å¼€</button>
                    </div>
                `;
                
                // åŠ è½½æ•°æ®
                await loadDashboardData();
                await loadStakingData();
                
                // è®¢é˜…äº‹ä»¶
                subscribeToEvents();
                
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                alert('è¿æ¥å¤±è´¥: ' + error.message);
            }
        }

        // åˆ‡æ¢åˆ°BSCæµ‹è¯•ç½‘
        async function switchToBSCTestnet() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: '0x61' }],
                });
            } catch (switchError) {
                if (switchError.code === 4902) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x61',
                            chainName: 'BSC Testnet',
                            nativeCurrency: {
                                name: 'BNB',
                                symbol: 'BNB',
                                decimals: 18
                            },
                            rpcUrls: ['https://data-seed-prebsc-1-s1.binance.org:8545/'],
                            blockExplorerUrls: ['https://testnet.bscscan.com/']
                        }]
                    });
                }
            }
        }

        // åŠ è½½ä»ªè¡¨ç›˜æ•°æ®
        async function loadDashboardData() {
            if (!connected) return;
            
            try {
                const hcfContract = new ethers.Contract(CONTRACTS.HCF, HCF_ABI, provider);
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, provider);
                
                // è·å–ä½™é¢
                const [hcfBalance, bnbBalance, totalSupply, userInfo] = await Promise.all([
                    hcfContract.balanceOf(account),
                    provider.getBalance(account),
                    hcfContract.totalSupply(),
                    stakingContract.getUserInfo(account)
                ]);
                
                // æ›´æ–°UI
                document.getElementById('hcf-balance').textContent = ethers.utils.formatUnits(hcfBalance, 18).slice(0, 10);
                document.getElementById('bnb-balance').textContent = ethers.utils.formatUnits(bnbBalance, 18).slice(0, 8);
                document.getElementById('total-supply').textContent = (Number(ethers.utils.formatUnits(totalSupply, 18)) / 1000000000).toFixed(1) + 'B';
                
                // è®¡ç®—æ—¥æ”¶ç›Š
                const stakedAmount = Number(ethers.utils.formatUnits(userInfo.amount || userInfo[0], 18));
                const level = Number(userInfo.level || userInfo[4]);
                const rates = [0.004, 0.005, 0.006, 0.007, 0.008];
                const dailyIncome = stakedAmount * (rates[level - 1] || 0) * 0.7; // 70%åŠ¨æ€æ”¶ç›Š
                document.getElementById('daily-income').textContent = dailyIncome.toFixed(2);
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½è´¨æŠ¼æ•°æ®
        async function loadStakingData() {
            if (!connected) return;
            
            try {
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, provider);
                const userInfo = await stakingContract.getUserInfo(account);
                
                document.getElementById('my-staked').textContent = ethers.utils.formatUnits(userInfo.amount || userInfo[0], 18) + ' HCF';
                document.getElementById('my-level').textContent = 'Level ' + (userInfo.level || userInfo[4]);
                document.getElementById('pending-rewards').textContent = ethers.utils.formatUnits(userInfo.pendingReward || userInfo[2], 18) + ' HCF';
                document.getElementById('total-rewards').textContent = ethers.utils.formatUnits(userInfo.totalClaimed || userInfo[6], 18) + ' HCF';
                
            } catch (error) {
                console.error('åŠ è½½è´¨æŠ¼æ•°æ®å¤±è´¥:', error);
            }
        }

        // é€‰æ‹©è´¨æŠ¼ç­‰çº§
        function selectStakingLevel(level, element) {
            selectedLevel = level;
            document.querySelectorAll('.level-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            // æ›´æ–°æ‹†åˆ†æ˜¾ç¤º
            updateStakeSplit();
        }

        // æ›´æ–°è´¨æŠ¼æ‹†åˆ†æ˜¾ç¤º
        function updateStakeSplit() {
            const amount = document.getElementById('stake-amount').value;
            if (!amount || amount <= 0) {
                document.getElementById('stake-split').textContent = 'ç­‰å¾…è¾“å…¥...';
                return;
            }
            
            const isLP = document.getElementById('is-lp').checked;
            const isEquity = document.getElementById('is-equity').checked;
            
            let splitText = `è´¨æŠ¼ ${amount} HCF\n`;
            if (isLP) {
                splitText += `LPæ¨¡å¼: åŒå€æ”¶ç›Š\n`;
            }
            if (isEquity) {
                splitText += `è‚¡æƒæ¨¡å¼: +50%æ”¶ç›Š\n`;
            }
            
            const rates = [0.004, 0.005, 0.006, 0.007, 0.008];
            const rate = rates[selectedLevel - 1] || 0;
            const baseYield = amount * rate;
            const actualYield = baseYield * 0.7 * (isLP ? 2 : 1) * (isEquity ? 1.5 : 1);
            
            splitText += `é¢„è®¡æ—¥æ”¶ç›Š: ${actualYield.toFixed(2)} HCF`;
            
            document.getElementById('stake-split').textContent = splitText;
            document.getElementById('actual-yield').textContent = actualYield.toFixed(2) + ' HCF';
        }

        // è´¨æŠ¼
        async function stake() {
            if (!connected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            const amount = document.getElementById('stake-amount').value;
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥è´¨æŠ¼æ•°é‡');
                return;
            }
            
            try {
                const hcfContract = new ethers.Contract(CONTRACTS.HCF, HCF_ABI, signer);
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, signer);
                
                const amountWei = ethers.utils.parseUnits(amount, 18);
                const isLP = document.getElementById('is-lp').checked;
                const isEquity = document.getElementById('is-equity').checked;
                
                // æˆæƒ
                const approveTx = await hcfContract.approve(CONTRACTS.Staking, amountWei);
                await approveTx.wait();
                
                // è´¨æŠ¼
                const stakeTx = await stakingContract.stake(amountWei, isLP, isEquity);
                await stakeTx.wait();
                
                alert('è´¨æŠ¼æˆåŠŸï¼');
                await loadStakingData();
                
            } catch (error) {
                console.error('è´¨æŠ¼å¤±è´¥:', error);
                alert('è´¨æŠ¼å¤±è´¥: ' + error.message);
            }
        }

        // èµå›
        async function unstake() {
            if (!connected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            if (!confirm('ç¡®å®šè¦èµå›å…¨éƒ¨è´¨æŠ¼å—ï¼Ÿå¯èƒ½ä¼šæœ‰30%çš„é”€æ¯æƒ©ç½š')) {
                return;
            }
            
            try {
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, signer);
                const tx = await stakingContract.unstake();
                await tx.wait();
                
                alert('èµå›æˆåŠŸï¼');
                await loadStakingData();
                
            } catch (error) {
                console.error('èµå›å¤±è´¥:', error);
                alert('èµå›å¤±è´¥: ' + error.message);
            }
        }

        // é¢†å–å¥–åŠ±
        async function claimRewards() {
            if (!connected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            try {
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, signer);
                const tx = await stakingContract.claimReward();
                await tx.wait();
                
                alert('é¢†å–æˆåŠŸï¼(å·²æ‰£é™¤5%æ¡¥æ¥è´¹)');
                await loadStakingData();
                
            } catch (error) {
                console.error('é¢†å–å¤±è´¥:', error);
                alert('é¢†å–å¤±è´¥: ' + error.message);
            }
        }

        // å¤æŠ•
        async function compound() {
            if (!connected) {
                alert('è¯·å…ˆè¿æ¥é’±åŒ…');
                return;
            }
            
            const multiple = document.getElementById('compound-multiple').value;
            
            try {
                const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, signer);
                const tx = await stakingContract.compound(multiple);
                await tx.wait();
                
                alert(`å¤æŠ•æˆåŠŸï¼å€æ•°: ${multiple}x`);
                await loadStakingData();
                
            } catch (error) {
                console.error('å¤æŠ•å¤±è´¥:', error);
                alert('å¤æŠ•å¤±è´¥: ' + error.message);
            }
        }

        // è‚¡æƒLPæ”¯ä»˜
        function payEquityLP() {
            alert('è‚¡æƒLPæ”¯ä»˜åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // è¡¥å¿æ— å¸¸æŸå¤±
        function claimCompensation() {
            alert('æ— å¸¸æŸå¤±è¡¥å¿åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // æ–­å¼€è¿æ¥
        function disconnect() {
            account = null;
            connected = false;
            provider = null;
            signer = null;
            
            document.getElementById('wallet-status').innerHTML = `
                <button class="btn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>
            `;
        }

        // è®¢é˜…äº‹ä»¶
        function subscribeToEvents() {
            if (!connected) return;
            
            const hcfContract = new ethers.Contract(CONTRACTS.HCF, HCF_ABI, provider);
            const stakingContract = new ethers.Contract(CONTRACTS.Staking, STAKING_ABI, provider);
            
            // ç›‘å¬Transferäº‹ä»¶
            hcfContract.on('Transfer', (from, to, amount) => {
                if (from === account || to === account) {
                    loadDashboardData();
                }
            });
            
            // ç›‘å¬Stakedäº‹ä»¶
            stakingContract.on('Staked', (user, amount) => {
                if (user === account) {
                    loadStakingData();
                }
            });
            
            // ç›‘å¬RewardsClaimedäº‹ä»¶
            stakingContract.on('RewardsClaimed', (user, amount) => {
                if (user === account) {
                    loadStakingData();
                }
            });
        }

        // ç›‘å¬è¾“å…¥å˜åŒ–
        document.getElementById('stake-amount')?.addEventListener('input', updateStakeSplit);
        document.getElementById('is-lp')?.addEventListener('change', updateStakeSplit);
        document.getElementById('is-equity')?.addEventListener('change', updateStakeSplit);

        // ç›‘å¬è´¦æˆ·å˜åŒ–
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    disconnect();
                } else if (account !== accounts[0]) {
                    account = accounts[0];
                    connectWallet();
                }
            });
        }
    </script>
</body>
</html>